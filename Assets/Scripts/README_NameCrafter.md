# Name Crafter ゲームシステム

## 概要

**Name Crafter**は、DeductionGameManagerをベースとした創作型ネーミングゲームです。プレイヤーは与えられたお題に沿ってオリジナルの名前を作り、その出来を競い合います。

## ゲームモード

### 通常モード (Normal Mode)
- 全員が自由回答でオリジナルの名前を作成
- 他プレイヤーの作品に点数配分制で投票
- 創造性とワードセンスを競う

### 選択モード (Selection Mode)  
- 提示された候補から最適な名前を選択
- プレイヤー間の選択一致率を計算・表示
- 言語的感性の距離感を可視化

## ゲームフロー

### 1. ゲーム開始
- 3〜8名でのマルチプレイ
- ホストがゲームモードを選択

### 2. 単語選択フェーズ
- 3名のプレイヤーがローテーションで単語を選択
- 形容詞2つ + 名詞1つの組み合わせ
- 各プレイヤーは4つの選択肢から1つを選択

### 3. 回答フェーズ
- **通常モード**: 選択された単語を使って自由に名前を作成（90秒）
- **選択モード**: 4つの名前候補から最適なものを選択（60秒）

### 4. 投票フェーズ（通常モードのみ）
- 持ち点：(プレイヤー数-1) × 100点
- 他プレイヤーの作品に点数を配分
- 全配分完了で投票完了（150秒）

### 5. 結果発表
- **通常モード**: 得票数によるランキング
- **選択モード**: 選択一致率の表示

## 主要コンポーネント

### NameCrafterGameManager
- ゲーム全体の進行管理
- ネットワーク同期
- フェーズ管理とタイマー制御

### NameCrafterTopicSet
- 単語カードデータベース
- 形容詞・名詞の管理
- 選択モード用候補の管理

### NameCrafterVotingSystem
- 点数配分制投票システム
- 持ち点管理
- 投票UI制御

### NameCrafterResultsCalculator
- 結果計算とランキング処理
- 統計データ生成
- 自動配分処理（未完了投票者対応）

## セットアップ方法

### 1. Prefabの作成
1. `NameCrafterGameManager`をGameObjectに配置
2. `NameCrafterVotingSystem`コンポーネントを同じGameObjectに追加
3. UI要素を適切に配置・接続
4. NetworkObjectコンポーネントを追加
5. Prefabとして保存

### 2. FusionConnectorへの登録
1. FusionConnectorのInspectorを開く
2. `Name Crafter Game Prefab`フィールドに作成したPrefabを設定

### 3. GameModeSelectorの設定
1. GameModeSelectorのInspectorを開く
2. `Name Crafter Game Button`を設定
3. UIにName Crafterボタンを追加

### 4. データセットの作成
1. `NameCrafterTopicSet`アセットを作成
2. 形容詞・名詞・選択肢を登録
3. サンプルデータ生成機能を活用

### 5. UI要素の接続
- ゲームモード選択UI
- 単語選択UI
- 回答入力UI
- 投票システムUI
- 結果表示UI

**重要**: Name CrafterGameManagerは直接シーンに置かず、FusionConnectorから動的に生成されます。

## 投票システムの仕様

### 持ち点計算
```
持ち点 = (プレイヤー数 - 1) × 100
```

### 自動配分（未完了投票者）
- 未回答者を除いた他プレイヤーに均等配分
- 端数は切り捨て処理

### 端数発生条件例
- n=5, m=1: 400÷3=133 (1点切り捨て)
- n=6, m=2: 500÷3=166 (2点切り捨て)
- n=8, m=1: 700÷6=116 (4点切り捨て)

## ランキング計算

### 順位決定優先度
1. **合計点** (最重要)
2. **平均点**
3. **最大1ラウンド得点**
4. **最終ラウンド得点**

全て一致した場合は同順位

## 統計情報

### 通常モード
- 合計点・平均点
- 合計得票率
- 最大1R得点・最終R得点

### 選択モード
- 選択一致率
- 最高一致率プレイヤー
- 最低一致率プレイヤー

## カスタマイズ

### タイマー設定
- 単語選択時間: 30秒
- 回答作成時間: 90秒（通常モード）
- 選択時間: 60秒（選択モード）
- 投票時間: 150秒

### プレイヤー数
- 最小: 3名
- 最大: 8名
- 推奨: 4-6名

## 技術仕様

### ネットワーク
- Photon Fusion使用
- リアルタイム同期
- 権限管理

### データ構造
- NetworkArray使用
- 効率的なデータ同期
- 状態管理

### UI
- TextMeshPro対応
- 動的UI生成
- レスポンシブデザイン

## トラブルシューティング

### よくある問題
1. **投票が完了しない**
   - 持ち点の全配分を確認
   - タイマー切れ時は自動配分

2. **単語が表示されない**
   - NameCrafterTopicSetの設定確認
   - データの有効性チェック

3. **結果が表示されない**
   - ResultsUIの接続確認
   - ネットワーク権限の確認

### デバッグ情報
- `[NameCrafter]`タグでログ出力
- フェーズ遷移の詳細ログ
- 投票・結果計算の詳細ログ

## 今後の拡張予定

### 機能追加案
- カスタムお題機能
- チーム戦モード
- ランキング履歴
- 統計データ保存
- UIテーマ切り替え

### パフォーマンス最適化
- データ圧縮
- UI最適化
- メモリ使用量削減

---

**開発者向け注意事項**

このシステムはDeductionGameManagerの構造を基盤としており、既存のTriviaPlayerシステムと連携して動作します。新機能の追加時は、ネットワーク同期とフェーズ管理に十分注意してください。
